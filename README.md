# RealTeeth 날씨 앱

사용자의 현재 위치 또는 검색한 위치의 정확한 날씨 정보를 대한민국 기상청(KMA) API를 활용하여 제공하는 웹 애플리케이션입니다.

## 🚀 프로젝트 실행 방법

본 프로젝트는 `pnpm`을 패키지 매니저로 사용합니다.

1. **의존성 설치**

   ```bash
   pnpm install
   ```

2. **환경 변수 설정**
   루트 경로에 `.env.production`, `.env.development` 파일을 생성하고 기상청 API 키를 입력합니다.

   ```env
   VITE_KMA_API_KEY=발급받은_기상청_API_키
   ```

3. **개발 서버 실행**
   ```bash
   pnpm dev
   ```
   이후 브라우저에서 `http://localhost:3000`으로 접속합니다.

## ✨ 구현 기능

- **실시간 날씨 및 시간별 예보 조회**: 기상청의 초단기실황 및 단기예보 API를 활용해 현재 온도, 습도, 풍속, 강수 형태와 24시간 시간별 일기예보 서비스를 제공합니다.

- **GPS 기반 위치 조회**: 사용자의 GPS 좌표를 기반으로 Geocoding API를 활용하여 현재 위치를 확인하고 해당 위치의 날씨 정보를 조회할 수 있습니다.
- **주소 기반 지역 검색**: 사용자가 시/구/동/읍/면 단위로 검색하여 해당 지역의 날씨를 조회할 수 있습니다.
- **즐겨찾기(Bookmark) 기능**: 자주 확인하는 지역을 최대 6개까지 즐겨찾기로 등록하여 빠르게 날씨를 확인할 수 있습니다.
- **위치 기반 새로고침**: 사용자의 현재 위치를 기반으로 즉시 날씨 데이터를 갱신합니다.

<br>

## 🛠 기술적 의사결정 및 이유

- **기상청(KMA) API 채택**: 글로벌 API인 `OpenWeather`는 전 세계를 커버하기 위해 넓은 단위의 예측 모델을 사용하는 반면 기상청 API는 대한민국 지형에 최적화된 5km 단위의 정밀한 격자망을 사용합니다. 따라서 국내 특정 동네의 날씨를 훨씬 디테일하고 정확하게 반영할 수 있어 기상청 API를 선택

- **es-hangul을 활용한 한글 초성 검색 최적화**: 사용자가 동/읍/면 단위로 지역을 쉽게 찾을 수 있도록 도입. 특히 모바일 환경에서 한글을 끝까지 타이핑하지 않고 초성만으로도 빠르고 정확하게 필터링하여 검색할 수 있어 검색 속도를 대폭 향상

- **TanStack Query를 통한 서버 상태 관리**: 날씨 좌표(`nx`, `ny`)를 배열 형태의 쿼리키(`['currentWeather', nx, ny]` 등)로 묶어 지역별로 데이터를 분리 및 캐싱했습니다. API 특성상 업데이트 시기가 다르므로 초단기 실황(현재 날씨)은 `10분`, 단기 예보(시간별 날씨)는 `1시간`을 `staleTime`으로 설정하여 중복 호출 방지

- **Zod를 이용한 API 응답 검증**: 공공 API의 특성상 응답 데이터의 타입이나 구조가 가끔 불안정할 수 있습니다. Zod 스키마를 정의하여 런타임 단계에서 예상치 못한 응답 포맷 방지

- **Zustand를 이용한 클라이언트 상태 관리**: 즐겨찾기 목록과 같이 전역으로 공유되어야 하는 클라이언트 상태를 가볍게 관리하기 위해 보일러플레이트가 적고 직관적인 Zustand 사용

- **Shadcn UI 도입**: Tailwind CSS와 완벽히 호환되며 필요한 컴포넌트 코드를 직접 가져와 입맛에 맞게 커스텀할 수 있어 유연하고 빠른 UI 개발을 위해 채택

<br>

## 💻 사용한 기술 스택

- **프레임워크 및 언어**: React 19, TypeScript, Vite
- **상태 관리**:
  - `Zustand` (클라이언트 전역 상태 - 즐겨찾기 등)
  - `Tanstack Query` (서버 데이터 캐싱 및 비동기 상태 관리)
- **데이터 검증**: `Zod`
- **UI 및 스타일링**: `Shadcn UI`, `Tailwind CSS v4`
- **유틸리티**: `es-hangul` (한국어 주소 검색 및 초성 추출, 검색 로직 고도화)

<br>

## 🎯 트러블슈팅 및 해결 과정

### 1. 기상청 API 연동을 위한 지역 데이터 구조 변환 (JSON)

- **문제**: 기상청 API는 날씨 조회를 위해 위도, 경도가 아닌 전용 `nx`, `ny` 격자 좌표값을 요구했습니다. 사용자가 입력하는 주소 텍스트를 기상청 좌표계로 변환할 방법이 필요했습니다.

- **해결**: 기상청에서 제공하는 전국 구역별 격자 매핑 엑셀 파일을 찾은 뒤 이를 클라이언트에서 즉시 검색 및 매핑할 수 있도록 `korea_districts.json` 형식으로 정제하였습니다. 서버리스 환경에서 `es-hangul`을 조합하여 사용자가 검색한 한국어 주소(동/읍/면)를 JSON 파일에서 매핑하여 즉시 `nx`, `ny` 좌표를 추출해 API를 호출하도록 구현했습니다.

### 2. 기상청 API의 시간 호출 (Base Time) 및 아이콘 맵핑

- **문제**:
  1. 기상청 API(초단기실황, 단기예보)는 데이터 생성 시간이 고정되어 있어(예: 02시 10분, 05시 10분 등) 현재 시간에 맞춰 정확한 `base_date`와 `base_time`을 계산하여 요청하지 않으면 에러 목록을 반환하는 문제가 있었습니다.

  2. 반환되는 날씨 상태값이 `SKY(하늘상태 1,3,4)`와 `PTY(강수형태 0~7)`라는 여러 개의 숫자 코드로 찢어져 있어 직관적인 UI(맑음, 비/눈 등)로 표시하기 어려웠습니다.

- **해결**:
  1. **시간 계산 유틸리티 구현 (`kma-time-utils.ts`)**: 사용자의 접속 시간을 기준으로 가장 최근에 발표된 기상청 API의 발표 시간을 역산하는 로직을 방어적으로 구현했습니다. 자정을 넘어가는 케이스나 예보 시간이 도래하기 전의 케이스를 분기 처리하여 항상 유효한 데이터를 가져오도록 시간 호출 로직을 고도화했습니다.

  2. **아이콘 및 상태 맵핑 로직 분리 (`kma-weather-mapper.ts`)**: `SKY`와 `PTY` 값을 종합적으로 판단하여 비/눈 등의 강수 상태를 우선순위로 두고 강수가 없을 경우 `SKY` 값과 낮/밤 여부를 조합해 직관적인 설명 텍스트("구름 많음", "맑음")와 명시적인 날씨 아이콘(Lucide React 조합)으로 변환해주는 맵퍼를 구현하여 UI 단의 복잡성을 제거했습니다.
